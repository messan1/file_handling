"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const stream_1 = require("stream");
const crypto_1 = require("crypto");
/**
 * Passes through its contents and ammends a hex-encoded hash of the data upon "end".
 *
 * @internal
 */
class AppendHashStream extends stream_1.Transform {
    constructor(algorithm = "sha1") {
        super();
        this.hash = crypto_1.createHash(algorithm);
    }
    _transform(chunk, _, callback) {
        this.hash.update(chunk);
        callback(null, chunk);
    }
    _flush() {
        this.push(this.digest(), "utf-8");
    }
    digest() {
        if (typeof this._digest !== "undefined")
            return this._digest;
        return (this._digest = this.hash.digest("hex"));
    }
}
exports.default = AppendHashStream;
//# sourceMappingURL=append-hash-stream.js.map